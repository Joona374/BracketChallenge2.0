<div class="dashboard-container">
  <div class="dashboard-header">
    <div class="user-profile">
      <div
        class="avatar-circle"
        (click)="openLogoSelectionModal()"
        title="Click to change logo"
      >
        <!-- Show team logo if available, fallback to initials -->
        <img
          *ngIf="user && user.logoUrl"
          [src]="user.logoUrl"
          class="team-logo"
          alt="Team Logo"
        />
        <span *ngIf="!(user && user.logoUrl)" class="initials">{{
          getUserInitials()
        }}</span>

        <!-- Add hover indicator to show it's clickable -->
        <div class="edit-overlay">
          <span class="edit-icon">✎</span>
        </div>
      </div>
      <div class="user-info">
        <h1>{{ user?.username || "User" }} Kotisivu</h1>
        <h2>{{ user?.teamName || "Team Name Not Set" }}</h2>
      </div>
    </div>

    <div class="rank-display">
      <span class="rank-label">Sija</span>
      <span class="rank-value">#{{ userRank || "-" }}</span>
    </div>

    <div class="points-summary">
      <div class="total-points">
        <span class="points-value">{{ points.total }}</span>
        <span class="points-label">KOKONAIS PISTEET</span>
      </div>
      <div class="points-breakdown">
        <div class="point-category">
          <span class="category-name">Bracket</span>
          <span class="category-points">{{ points.bracket }}</span>
        </div>
        <div class="point-category">
          <span class="category-name">Kokoonpano</span>
          <span class="category-points">{{ points.lineup }}</span>
        </div>
        <div class="point-category">
          <span class="category-name">Top 3 Pelaajat</span>
          <span class="category-points">{{ points.predictions }}</span>
        </div>
      </div>
    </div>
  </div>

  <div class="dashboard-content">
    <!-- Bracket Summary Card -->
    <div class="dashboard-card bracket-card">
      <div class="card-header">
        <h3>Playoff Bracket</h3>
        <button routerLink="/bracket" class="action-link">Muokkaa</button>
      </div>

      <div class="card-content">
        <div class="progress-container">
          <div class="progress-bar">
            <div
              class="progress-fill"
              [style.width.%]="
                getProgressPercentage(
                  bracketSummary.completed,
                  bracketSummary.total
                )
              "
            ></div>
          </div>
          <div class="progress-text">
            {{ bracketSummary.completed }}/{{ bracketSummary.total }} Matchups
            Selected
          </div>
        </div>

        <div class="summary-detail" *ngIf="bracketSummary.topPick">
          <span class="detail-label">Your Champion:</span>
          <span class="detail-value">{{ bracketSummary.topPick }}</span>
        </div>

        <div class="card-stats">
          <div class="stat-item">
            <span class="stat-value">{{ points.bracket }}</span>
            <span class="stat-label">Points</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Lineup Summary Card -->
    <div class="dashboard-card lineup-card">
      <div class="card-header">
        <h3>Kokoonpano</h3>
        <button routerLink="/lineup" class="action-link">Muokkaa</button>
      </div>

      <div class="card-content">
        <div class="lineup-details">
          <div class="lineup-info">
            <div class="budget-detail">
              <span class="detail-label">Kokonaisarvo:</span>
              <span
                class="detail-value"
                [class.value-high]="lineupSummary.totalValue > 2000000"
                >{{ formatCurrency(lineupSummary.totalValue) }}</span
              >
            </div>
            <div class="budget-detail">
              <span class="detail-label">Budjetti Jäljellä:</span>
              <span
                class="detail-value"
                [class.value-low]="lineupSummary.unusedBudget < 30000"
                >{{ formatCurrency(lineupSummary.unusedBudget) }}</span
              >
            </div>
            <div class="budget-detail">
              <span class="detail-label">Vaihtoja Jäljellä:</span>
              <span
                class="detail-value"
                [class.value-low]="lineupSummary.remainingTrades <= 0"
                >{{ lineupSummary.remainingTrades }}</span
              >
            </div>
          </div>
          <div class="player-grid">
            <div
              *ngFor="let position of ['VL', 'KH', 'OL', 'VP', 'OP', 'MV']"
              class="player-slot"
            >
              <span class="position-label">{{ position }}:</span>
              <span
                class="player-name"
                *ngIf="getPlayerByPosition(position) as player"
              >
                {{ player.firstName }} {{ player.lastName }}
                <span class="player-price">{{
                  formatCurrency(player.price)
                }}</span>
              </span>
              <span class="empty-slot" *ngIf="!getPlayerByPosition(position)"
                >Tyhjä</span
              >
            </div>
          </div>
        </div>

        <div class="card-stats">
          <div class="stat-item">
            <span class="stat-value">{{ points.lineup }}</span>
            <span class="stat-label">Pisteet</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Predictions Summary Card -->
    <div class="dashboard-card predictions-card">
      <div class="card-header">
        <h3>Top 3 Predictions</h3>
        <button routerLink="/predictions" class="action-link">Muokkaa</button>
      </div>

      <div class="card-content">
        <div class="progress-container">
          <div class="progress-bar">
            <div
              class="progress-fill"
              [style.width.%]="
                getProgressPercentage(
                  predictionsSummary.completed,
                  predictionsSummary.totalToComplete
                )
              "
            ></div>
          </div>
          <div class="progress-text">
            {{ predictionsSummary.completed }}/{{
              predictionsSummary.totalToComplete
            }}
            Predictions Made
          </div>
        </div>

        <div class="picks-list">
          <div
            class="pick-item"
            *ngFor="let pick of predictionsSummary.top3Picks; let i = index"
          >
            <span class="pick-number">{{ i + 1 }}.</span>
            <span class="pick-name">{{ pick }}</span>
          </div>
          <div
            class="pick-item empty"
            *ngFor="
              let empty of [].constructor(
                predictionsSummary.totalToComplete -
                  predictionsSummary.top3Picks.length
              )
            "
          >
            <span class="pick-number"
              >{{ predictionsSummary.top3Picks.length + 1 }}.</span
            >
            <span class="pick-name empty">Not Selected</span>
          </div>
        </div>

        <div class="card-stats">
          <div class="stat-item">
            <span class="stat-value">{{ points.predictions }}</span>
            <span class="stat-label">Points</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Logo Selection Modal -->
  <app-logo-selection
    *ngIf="showLogoSelectionModal"
    (closeModal)="closeLogoSelectionModal()"
    (logoSelected)="handleLogoSelected($event)"
  >
  </app-logo-selection>
</div>
