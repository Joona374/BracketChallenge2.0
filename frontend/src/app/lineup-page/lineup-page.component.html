<!-- New container for top section -->
<div class="lineup-top-container">
  <!-- Left side: player slots -->
  <div class="lineup-wrapper">
    <h2 class="section-header">
      {{
        lineupLocked
          ? "Tee muutoksia kokoonpanoon"
          : "Valitse Aloituskokoonpano"
      }}
    </h2>

    <div class="slot-container">
      <!-- Forwards -->
      <div class="lineup-row forwards">
        <div
          *ngFor="let slot of forwardSlots"
          class="slot"
          [ngClass]="getPlayerClass(slot)"
          [class.active]="selectedSlot === slot"
          (click)="onSlotClick(slot)"
        >
          <span>{{ formatPlayer(slot) }}</span>
        </div>
      </div>

      <!-- Defenders -->
      <div class="lineup-row defenders">
        <div class="spacer"></div>
        <div
          *ngFor="let slot of defenderSlots"
          class="slot"
          [ngClass]="getPlayerClass(slot)"
          [class.active]="selectedSlot === slot"
          (click)="onSlotClick(slot)"
        >
          <span>{{ formatPlayer(slot) }}</span>
        </div>
      </div>

      <!-- Goalie -->
      <div class="lineup-row goalie">
        <div class="spacer"></div>
        <div class="spacer"></div>
        <div
          class="slot"
          [ngClass]="getPlayerClass(goalieSlot)"
          [class.active]="selectedSlot === goalieSlot"
          (click)="onSlotClick(goalieSlot)"
        >
          <span>{{ formatPlayer(goalieSlot) }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Right side: budget and controls -->
  <div class="lineup-side-panel">
    <!-- Budget display -->
    <div class="budget-display">
      <span class="budget-label">Budjettia J√§ljell√§:</span>
      <span
        class="budget-value"
        [ngClass]="{ 'budget-warning': remainingBudget < 500000 }"
      >
        {{ formatPrice(remainingBudget) }}
      </span>
    </div>

    <!-- Trade counter display -->
    <div class="trades-display" *ngIf="lineupLocked">
      <span class="trades-label">Vaihtoja J√§ljell√§:</span>
      <span
        class="trades-value"
        [ngClass]="{ 'trades-warning': effectiveRemainingTrades < 3 }"
      >
        {{ effectiveRemainingTrades }}/{{ maxTrades }}
      </span>
    </div>

    <!-- Controls (fixed typo in class name) -->
    <div class="controls">
      <button class="lineup-button save" (click)="saveLineup()">
        üíæ Tallenna Kokoonpano
      </button>
      <button
        *ngIf="!lineupLocked"
        class="lineup-button clear"
        (click)="clearLineup()"
      >
        üßπ Tyhenn√§ Kokoonpano
      </button>
      <button
        *ngIf="lineupLocked"
        class="lineup-button reset"
        (click)="resetLineup()"
      >
        ‚Ü∫ Palauta Kokoonpano
      </button>
      <input
        type="text"
        placeholder="Hae pelaajan tai joukkueen nimell√§..."
        [(ngModel)]="searchTerm"
        class="search-box"
      />
    </div>
  </div>
</div>

<!-- Scrollable Player Table -->
<div class="player-table-container">
  <!-- Table content remains unchanged -->
</div>

<!-- Scrollable Player Table -->
<div class="player-table-container">
  <table class="player-table">
    <thead>
      <tr>
        <th
          (click)="sortBy('position')"
          [class.sorted]="sortKey === 'position'"
        >
          Pelipaikka
          <span *ngIf="sortKey === 'position'">{{ sortAsc ? "‚ñ≤" : "‚ñº" }}</span>
        </th>
        <th
          (click)="sortBy('firstName')"
          [class.sorted]="sortKey === 'firstName'"
        >
          Etunimi
          <span *ngIf="sortKey === 'firstName'">{{ sortAsc ? "‚ñ≤" : "‚ñº" }}</span>
        </th>
        <th
          (click)="sortBy('lastName')"
          [class.sorted]="sortKey === 'lastName'"
        >
          Sukunimi
          <span *ngIf="sortKey === 'lastName'">{{ sortAsc ? "‚ñ≤" : "‚ñº" }}</span>
        </th>
        <th (click)="sortBy('team')" [class.sorted]="sortKey === 'team'">
          Joukkue
          <span *ngIf="sortKey === 'team'">{{ sortAsc ? "‚ñ≤" : "‚ñº" }}</span>
        </th>
        <th (click)="sortBy('isU23')" [class.sorted]="sortKey === 'isU23'">
          U23
          <span *ngIf="sortKey === 'isU23'">{{ sortAsc ? "‚ñ≤" : "‚ñº" }}</span>
        </th>
        <th
          (click)="sortBy('reg_gp')"
          [class.sorted]="sortKey === 'reg_gp'"
          class="stat-column"
        >
          Pelattu
          <span *ngIf="sortKey === 'reg_gp'">{{ sortAsc ? "‚ñ≤" : "‚ñº" }}</span>
        </th>
        <th
          (click)="sortBy('reg_goals')"
          [class.sorted]="sortKey === 'reg_goals'"
          class="stat-column"
        >
          Maalit
          <span *ngIf="sortKey === 'reg_goals'">{{ sortAsc ? "‚ñ≤" : "‚ñº" }}</span>
        </th>
        <th
          (click)="sortBy('reg_assists')"
          [class.sorted]="sortKey === 'reg_assists'"
          class="stat-column"
        >
          Sy√∂t√∂t
          <span *ngIf="sortKey === 'reg_assists'">{{
            sortAsc ? "‚ñ≤" : "‚ñº"
          }}</span>
        </th>
        <th
          (click)="sortBy('reg_points')"
          [class.sorted]="sortKey === 'reg_points'"
          class="stat-column"
        >
          Pisteet
          <span *ngIf="sortKey === 'reg_points'">{{
            sortAsc ? "‚ñ≤" : "‚ñº"
          }}</span>
        </th>
        <th
          (click)="sortBy('reg_plus_minus')"
          [class.sorted]="sortKey === 'reg_plus_minus'"
          class="stat-column"
        >
          +/-
          <span *ngIf="sortKey === 'reg_plus_minus'">{{
            sortAsc ? "‚ñ≤" : "‚ñº"
          }}</span>
        </th>
        <th (click)="sortBy('price')" [class.sorted]="sortKey === 'price'">
          Hinta
          <span *ngIf="sortKey === 'price'">{{ sortAsc ? "‚ñ≤" : "‚ñº" }}</span>
        </th>
      </tr>
    </thead>

    <tbody>
      <tr
        *ngFor="let player of availablePlayers"
        (click)="assignPlayerToSlot(player)"
      >
        <td>{{ player?.position || "" }}</td>
        <td>{{ player?.firstName || "" }}</td>
        <td>{{ player?.lastName || "" }}</td>
        <td>{{ player?.team || "" }}</td>
        <td>{{ player?.isU23 ? "‚úì" : "‚ùå" }}</td>
        <td class="stat-column">{{ player?.reg_gp || 0 }}</td>
        <td class="stat-column">{{ player?.reg_goals || 0 }}</td>
        <td class="stat-column">{{ player?.reg_assists || 0 }}</td>
        <td class="stat-column">{{ player?.reg_points || 0 }}</td>
        <td
          class="stat-column"
          [class.positive]="(player?.reg_plus_minus || 0) > 0"
          [class.negative]="(player?.reg_plus_minus || 0) < 0"
        >
          {{ (player?.reg_plus_minus || 0) > 0 ? "+" : ""
          }}{{ player?.reg_plus_minus || 0 }}
        </td>
        <td>{{ formatPrice(player?.price || 0) }}</td>
      </tr>
    </tbody>
  </table>
</div>
